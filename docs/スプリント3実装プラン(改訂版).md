# スプリント3実装計画

**User:** Anonymous (sunpin32@yahoo.co.jp)  
**Created:** 9/8/2025 16:17:26  
**Updated:** 9/8/2025 16:19:54  
**Exported:** 9/8/2025 16:21:17  
**Link:** [https://chatgpt.com/g/g-p-68a2428917408191ab595311b37e4516-itabashi-minutes/c/68be82fe-e1d0-832c-aceb-435dd9a31485](https://chatgpt.com/g/g-p-68a2428917408191ab595311b37e4516-itabashi-minutes/c/68be82fe-e1d0-832c-aceb-435dd9a31485)  

## Response:
思考時間: 1 秒

ドキュメントを読み込んでいます

完了

思考時間: 1m 16s

ドキュメントを読み込んでいます

スクリーンショットには4つの問題が表示されています。これには、Nightly カタログ再構築、MCP 横展開、API ページネーション、構造抽出精度向上といったものがあります。Sprint 3には、元々の8, 9, 10のアイテムに加え、これらの問題を考慮する必要があります。目標、基準、タスクの順序など、詳細な計画を立てます。

ユーザーは「Pythonのワンショットスクリプト」を好むので、差分適用用のスクリプト生成器を提案できます。ただし、将来の結果は約束できませんが、正確なタスクとコマンドを含める必要があります。次のアクションは、Sprint 3の実装計画を作成することです。

ユーザーが取り組んでいる課題に基づき、MCPサーバーを構築して、検索や取得操作を提供する提案をします。また、OpenAIやAnthropicクライアントの統合を検討したいと考えています。これには、Streamlit UI やAPI、MCP仕様をPythonで定義し、具体的なテストとコード構造も提案します。

私たちは「カタログビルドジョブ」の結果をGitHub Actionsのアーティファクトとして保存し、.duckdbとJSONを圧縮してGitHubリリース「catalog-YYYYmmdd」に添付する提案をします。また、エラーノーティフィケーションやデータプライバシーに関するステップも含め、一般的な提案を行います。

完了

穣太さん、スプリント3に入ります。  
スプリント2後に立った4Issue（#22〜#25）を踏まえて、当初計画（8〜10）を再編しました。過不足・依存関係を整理した「改訂版スプリント3実装計画」です。

スプリント3 実装計画（改訂版）
================

目的（到達ゴール）
---------

*   区議会データを「探せる・見られる・毎晩更新される」状態まで一気通貫化。
*   ツール連携（MCP）とAPIの使い勝手を上げ、運用をNightlyに載せる。

スコープ（In / Out）
--------------

*   In
    *   最小UI（Streamlit）検索→一覧→詳細（PDFリンク/テキスト表示）【#8拡張, #23】
    *   API v0.2：ページネーション、並び替え、ハイライト返却【#23】
    *   MCPサーバ横展開：ChatGPT/Claudeから `search_minutes`/`get_document`【#24】
    *   Nightlyカタログ再構築と成果物のArtifacts/Release出力、失敗通知【#25】
    *   構造抽出の精度向上（誤検知抑制、正規化辞書）＋回帰テスト強化【#22】
    *   再現実行手順（Makefile/poetry scripts）と “Verification Cheatsheet (Sprint 3)”
*   Out（次期以降）
    *   座標付きレイアウト抽出/OCR
    *   認証・多ユーザー管理
    *   本格ダッシュボード分析（可視化の拡充）

主要デリバラブル
--------

1.  **API v0.2**（/search, /document/{id}）
    *   `limit`/`offset`、`order_by`（`relevance|date|committee`）、`order`（asc/desc）
*   FTS5の `snippet()/highlight()` を使ったハイライト返却（`<em>…</em>`）
*   レスポンスに `total`, `page`, `has_next` を含める
    2.  **Streamlit UI v0.1**
    *   検索バー＋フィルタ（年度/委員会/話者）
*   一覧（スニペット強調、ページャ）
*   詳細（メタ情報／抽出テキスト／PDFへのリンク）
    3.  **MCPサーバ v0.1**
    *   ツール：`search_minutes(query, filters, limit)` / `get_document(meeting_id)`
*   manifestと接続手順（Claude/ChatGPT向け）をREADMEに同梱
    4.  **Nightlyジョブ**
    *   cron実行→クロール→カタログ構築→DuckDB/JSON/インデックス一式をArtifactsへ
*   週1で自動Release（`catalog-YYYYMMDD`）
*   失敗時：`actions/github-script` で Issue 作成＆通知
    5.  **構造抽出 精度向上**
    *   正規化辞書（役職名・委員会名・人名の表記ゆれ吸収）
*   誤検知抑制ルール（見出し様式の厳格化、否定先読み等）
*   スナップショット/ゴールデンセットで回帰を検知
    6.  **運用ドキュメント**
    *   “Verification Cheatsheet (Sprint 3)”（ローカルでUI/API/MCP/Nightly相当を再現）

* * *

実装タスク（PR粒度）
-----------

### A. API v0.2（#23）

*    `GET /search` に `limit/offset/order_by/order` を追加（デフォルト：`order_by=date desc`）
*    FTS5：`snippet(table, col, '<em>', '</em>', '…', 10)` でハイライト生成
*    単体/統合テスト：パラメータ境界、ハイライトのタグ整合、総件数
*    OpenAPI更新（/docsで確認）

### B. Streamlit UI（#23, #8の実装継続）

*    `app/streamlit_app.py`：検索フォーム、フィルタ、一覧（強調表示付き）、ページャ
*    詳細ビュー：抽出テキスト、PDFリンク（必要なら簡易プレビュー）
*    `pyproject.toml [tool.poetry.scripts]` に `ui-serve = "app.streamlit_app:main"` を追加
*    スナップショットE2E：代表クエリで画面要素検証

### C. MCPサーバ（#24）

*    `mcp/server.py`：`search_minutes`/`get_document` をAPIへプロキシ
*    manifest/README：Claude/ChatGPT接続例（設定JSON）
*    簡易テスト：ローカルで2ツールが値を返すこと

### D. Nightlyジョブ（#25）

*    `/.github/workflows/nightly.yml`：cron、キャッシュ、リトライ、タイムアウト
*    成果物：`/dist/catalog.duckdb`, `/dist/index.json`, `/dist/documents.ndjson` をArtifacts
*    週1 Release（タグ `catalog-YYYYMMDD`）。自動チェンジログ（件数増分）
*    失敗時Issue化（ログ添付）

### E. 構造抽出 精度向上（#22）

*    `resources/normalize.yml`：役職/委員会/氏名の別名→正規形
*    正規表現ルール強化（行頭アンカー、節番号パターン、否定先読み）
*    回帰テスト：ゴールデンPDFセットでPrecision/Recallの最低値を定義
*    誤検知事例を辞書へ継続反映（テスト先行）

### F. ドキュメントと再現手順

*    README末尾に “Verification Cheatsheet (Sprint 3)”
*    Makefile：`make catalog | make api | make ui | make mcp | make test`
*    `poetry run` での等価エントリ

* * *

Done条件（受け入れ基準）
--------------

*   UI：任意クエリで 1秒台（ローカル）で一覧表示、ハイライトが `<em>` タグで返る
*   API：`/search` が `limit/offset/order_by/order` を受け付け、`total/has_next` を返す
*   MCP：ChatGPT/Claude から `search_minutes` が呼べ、上位3件の要約が取れる
*   Nightly：2夜連続成功（Artifacts作成、Release週1）、失敗時に自動でIssue起票
*   抽出：ゴールデンセットで Precision ≥ 0.9 / Recall ≥ 0.85（暫定基準）

変更見込みの主なファイル/構成
---------------

```
/api/main.py           # v0.2 検索API
/app/streamlit_app.py  # UI
/mcp/server.py         # MCPエンドポイント
/resources/normalize.yml
/.github/workflows/nightly.yml
/Makefile
```

リスクと緩和
------

*   FTSスコアの不安定さ → 並び替え既定を `date desc`、関連度は明示オプション
*   Nightly失敗の長期化 → ジョブ分割（crawl/build/release）、失敗点を切り分け
*   誤検知増加 → ゴールデンセット＆スナップショットで早期検知

* * *

すぐ始めるチェックリスト（ローカル）
------------------

1.  `poetry run make catalog`（または `poetry run python -m catalog.build`）
2.  `poetry run api-serve` で `/docs` を確認
3.  `poetry run ui-serve` でUI確認
4.  `poetry run mcp-server` でツール疎通
5.  `pytest -q`（抽出の回帰テストを含む）

* * *

必要なら、この計画をIssueへ分割するMarkdown（チェックリスト付き）も直ちに用意します。どのPRから着手するか（API→UI→MCP→Nightly→精度向上、の順を推奨）で進めましょう。



---
Powered by [ChatGPT Exporter](https://www.chatgptexporter.com)