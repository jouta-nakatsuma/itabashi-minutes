2025-08-26T14:52:13.1116353Z ##[group]Run poetry run pytest -q
2025-08-26T14:52:13.1116701Z [36;1mpoetry run pytest -q[0m
2025-08-26T14:52:13.1157161Z shell: /usr/bin/bash -e {0}
2025-08-26T14:52:13.1157401Z env:
2025-08-26T14:52:13.1157600Z   PIP_DISABLE_PIP_VERSION_CHECK: 1
2025-08-26T14:52:13.1157869Z   PYTHONUNBUFFERED: 1
2025-08-26T14:52:13.1158089Z   CRAWLER_MIN_RECORDS: 5
2025-08-26T14:52:13.1158309Z   TZ: Asia/Tokyo
2025-08-26T14:52:13.1158763Z   pythonLocation: /opt/hostedtoolcache/Python/3.10.18/x64
2025-08-26T14:52:13.1159216Z   PKG_CONFIG_PATH: /opt/hostedtoolcache/Python/3.10.18/x64/lib/pkgconfig
2025-08-26T14:52:13.1159666Z   Python_ROOT_DIR: /opt/hostedtoolcache/Python/3.10.18/x64
2025-08-26T14:52:13.1160058Z   Python2_ROOT_DIR: /opt/hostedtoolcache/Python/3.10.18/x64
2025-08-26T14:52:13.1160445Z   Python3_ROOT_DIR: /opt/hostedtoolcache/Python/3.10.18/x64
2025-08-26T14:52:13.1160834Z   LD_LIBRARY_PATH: /opt/hostedtoolcache/Python/3.10.18/x64/lib
2025-08-26T14:52:13.1161156Z ##[endgroup]
2025-08-26T14:52:54.6847009Z F..............                                                          [100%]
2025-08-26T14:52:54.6849395Z =================================== FAILURES ===================================
2025-08-26T14:52:54.6849983Z ____________________________ test_catalog_load_e2e _____________________________
2025-08-26T14:52:54.6850401Z 
2025-08-26T14:52:54.6850740Z tmp_path = PosixPath('/tmp/pytest-of-runner/pytest-0/test_catalog_load_e2e0')
2025-08-26T14:52:54.6851218Z 
2025-08-26T14:52:54.6851458Z     def test_catalog_load_e2e(tmp_path: Path) -> None:
2025-08-26T14:52:54.6852266Z         # Prepare temp DB and source
2025-08-26T14:52:54.6852736Z         db_path = tmp_path / "var" / "minutes.db"
2025-08-26T14:52:54.6853572Z         # 検証用に対象ファイルのみをコピーしたソースディレクトリを用意
2025-08-26T14:52:54.6854019Z         src_dir = tmp_path / "src"
2025-08-26T14:52:54.6854465Z         src_dir.mkdir(parents=True, exist_ok=True)
2025-08-26T14:52:54.6854938Z         shutil.copyfile(
2025-08-26T14:52:54.6855528Z             Path("tests/fixtures/sample_minutes_01.json"), src_dir / "sample_minutes_01.json"
2025-08-26T14:52:54.6856184Z         )
2025-08-26T14:52:54.6856441Z     
2025-08-26T14:52:54.6856826Z         total, inserted, skipped = load_directory(db_path, src_dir)
2025-08-26T14:52:54.6857341Z         assert total >= 1
2025-08-26T14:52:54.6857687Z         assert inserted >= 1
2025-08-26T14:52:54.6858022Z     
2025-08-26T14:52:54.6858325Z         with sqlite3.connect(db_path) as conn:
2025-08-26T14:52:54.6859268Z             cur = conn.execute("SELECT COUNT(*) FROM minutes")
2025-08-26T14:52:54.6859767Z             assert cur.fetchone()[0] == 1
2025-08-26T14:52:54.6860155Z     
2025-08-26T14:52:54.6860500Z             cur = conn.execute("SELECT COUNT(*) FROM agenda_items")
2025-08-26T14:52:54.6860992Z             assert cur.fetchone()[0] >= 2
2025-08-26T14:52:54.6861366Z     
2025-08-26T14:52:54.6861698Z             cur = conn.execute("SELECT COUNT(*) FROM speeches")
2025-08-26T14:52:54.6862192Z             assert cur.fetchone()[0] >= 4
2025-08-26T14:52:54.6862584Z     
2025-08-26T14:52:54.6862833Z             # FTS
2025-08-26T14:52:54.6863128Z             cur = conn.execute(
2025-08-26T14:52:54.6863866Z                 "SELECT COUNT(*) FROM speeches_fts WHERE speeches_fts MATCH '教育長 OR 給食'"
2025-08-26T14:52:54.6864414Z             )
2025-08-26T14:52:54.6864708Z >           assert cur.fetchone()[0] >= 2
2025-08-26T14:52:54.6865305Z E           assert 1 >= 2
2025-08-26T14:52:54.6865489Z 
2025-08-26T14:52:54.6865602Z tests/test_catalog_load.py:38: AssertionError
2025-08-26T14:52:54.6865928Z =========================== short test summary info ============================
2025-08-26T14:52:54.6866380Z FAILED tests/test_catalog_load.py::test_catalog_load_e2e - assert 1 >= 2
2025-08-26T14:52:54.6866752Z 1 failed, 14 passed in 38.26s
2025-08-26T14:52:55.2621073Z ##[error]Process completed with exit code 1.
